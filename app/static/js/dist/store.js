!function(t){"use strict";function a(t,a){a=a||function(){},this._dbName=t,this.xhr=new XHR((!1));var o=this;this.xhr.get("/api/findAll",{user_id:TODO_USER},function(i){if(i=i.json(),1===i.success){var e={todos:i.data};localStorage[t]=JSON.stringify(e),a.call(o,i.data)}else alert(i.data)})}a.prototype.find=function(t,a){if(a){var o=JSON.parse(localStorage[this._dbName]).todos;a.call(this,o.filter(function(a){for(var o in t)if(t[o]!==a[o])return!1;return!0}))}},a.prototype.findAll=function(t){t=t||function(){},t.call(this,JSON.parse(localStorage[this._dbName]).todos)},a.prototype.save=function(t,a,o){var i=this;o&&(t.id=o),this.xhr.post("/api/save",t,function(e){if(e=e.json(),1===e.success){var r=JSON.parse(localStorage[i._dbName]),s=r.todos;if(a=a||function(){},o){for(var n=0;n<s.length;n++)if(s[n].id===o){for(var l in t)s[n][l]=t[l];break}localStorage[i._dbName]=JSON.stringify(r),a.call(i,s)}else t.id=e.data.id,s.push(t),localStorage[i._dbName]=JSON.stringify(r),a.call(i,[t])}else alert(e.data)})},a.prototype.remove=function(t,a){var o=this;this.xhr.post("/api/remove",{id:t},function(i){if(i=i.json(),1===i.success){for(var e=JSON.parse(localStorage[o._dbName]),r=e.todos,s=0;s<r.length;s++)if(r[s].id==t){r.splice(s,1);break}localStorage[o._dbName]=JSON.stringify(e),a.call(o,r)}else alert(i.data)})},a.prototype.drop=function(t){var a=this;this.xhr.post("/api/drop",{},function(o){o=o.json(),1===o.success?(localStorage[a._dbName]=JSON.stringify({todos:[]}),t.call(a,[])):alert(o.data)})},t.app=t.app||{},t.app.Store=a}(window);