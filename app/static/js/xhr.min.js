!function(e,t){"object"==typeof module&&module.exports?module.exports=t(e):e.XHR=t(e)}("undefined"!=typeof window?window:this,function(){var e=function(e){var t=function(e){var t=e.responseText,n=e.status,r=e.statusText,o=e.responseType,u=e.getAllResponseHeaders(),s=function(){try{return JSON.parse(t)}catch(e){return null}},c=e.responseXML,i=function(){return c},f=null,a=function(){if(null===f&&(f={},u))for(var e=u.split("\n"),t="",n=0;n<e.length;n++)t=e[n].split(": "),t&&2===t.length&&t[0]&&(f[t[0]]=t[1]);return f};return{text:t,status_code:n,status_text:r,response_type:o,header_text:u,json:s,xml:i,headers:a}},n=function(){},r=function(){return{ready:n,error:n,success:n,fail:n}},o="",u="",s={},c="",i=e!==!1,f=r(),a=new XMLHttpRequest,p=function(e,t){"ready"!==e&&"error"!==e&&"success"!==e&&"fail"!==e||"function"==typeof t&&(f[e]=t)},l=function(){var e=t(a);4===a.readyState?(f.ready(e,g),200===a.status?f.success(e,g):f.fail(e,g)):f.error(e,g)},d=function(e,t){s[e]=t},y=function(e){i=e},x=function(e){if(e&&"object"==typeof e){var t=encodeURIComponent,n=[];for(var r in e)n.push(t(r)+"="+t(e[r]));return n.join("&")}return""},h=function(e,t,n,r,s){return o=e,u=t,c=n,p("success",r),p("fail",s),T()},v=function(e,t,n,r){return t=x(t),t&&(e=e+"?"+t),h("GET",e,"",n,r)},w=function(e,t,n,r){return d("Content-Type","application/json"),"object"==typeof t&&(t=x(t),d("Content-Type","application/x-www-form-urlencoded")),h("POST",e,t,n,r)},T=function(){a.open(o,u,i);for(var e in s)a.setRequestHeader(e,s[e]);return a.onreadystatechange=l,a.send(c),g},b=function(){a&&a.abort()},j=function(){return u},m=function(){return c},R=function(){i=!0,u="",c="",o="",s={},f=r()},g={url:j,body:m,on:p,setRequestHeader:d,setAsync:y,request:h,get:v,post:w,abort:b,reset:R};return g};return e});